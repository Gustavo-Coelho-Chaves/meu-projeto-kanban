name: Deploy to EC2

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do código
        uses: actions/checkout@v2

      - name: Acessar EC2 e atualizar projeto
        run: |
          echo "${{ secrets.EC2_SSH_KEY }}" > id_rsa
          chmod 600 id_rsa
          ssh -o StrictHostKeyChecking=no -i id_rsa ec2-user@13.218.232.137 << 'EOF'
            cd /home/ec2-user/meu-projeto-kanban || exit
            git pull origin main || exit
            # Aqui você pode colocar comandos como:
            # docker compose down && docker compose up -d --build
            exit
EOF

      - name: Desligar instância EC2 (opcional)
        run: |
          ssh -o StrictHostKeyChecking=no -i id_rsa ec2-user@13.218.232.137 "sudo shutdown -h now"
